<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的学习工作生活记录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        study: '#3b82f6',      // 学习区域 - 蓝色
                        work: '#10b981',       // 工作区域 - 绿色
                        life: '#a855f7',       // 生活区域 - 紫色
                        background: '#f3f4f6', // 背景色
                        dark: {
                            bg: '#1f2937',
                            card: '#374151',
                            text: '#f3f4f6'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .section-shadow {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .content-auto {
                content-visibility: auto;
            }
            .page-active {
                background-color: currentColor;
                color: white;
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            .image-placeholder {
                background-size: cover;
                background-position: center;
            }
            .zoom-in {
                animation: zoomIn 0.3s ease-out;
            }
            @keyframes zoomIn {
                from { transform: scale(0.95); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-background min-h-screen transition-colors duration-300" id="app-body">
    <!-- 页面标题 -->
    <header class="py-8 bg-white shadow-md transition-colors duration-300" id="app-header">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <img src="images/白猫.png" alt="个人标识" class="w-16 h-16 rounded-full object-cover">

                <div>
                    <h1 class="text-[clamp(1.8rem,5vw,3rem)] font-bold text-center text-gray-800 transition-colors duration-300" id="main-title">
                        谷树自留地
                    </h1>
                    <p class="text-center text-gray-600 mt-2 transition-colors duration-300" id="subtitle">唯有热爱，才能长久</p>
                </div>
                
                <!-- 功能按钮区 -->
                <div class="flex flex-col md:flex-row items-center gap-4 mt-4 md:mt-0 w-full md:w-auto">
                    <!-- 搜索框区域 -->
                    <div class="w-full md:w-auto flex flex-col md:flex-row gap-3">
                        <div class="relative w-full md:w-64">
                            <input type="text" id="search-content" 
                                   placeholder="搜索内容..." 
                                   class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-study/50 transition-all">
                            <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        </div>
                        
                        <div class="relative w-full md:w-48">
                            <input type="date" id="search-date" 
                                   class="w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-study/50 transition-all">
                            <i class="fa fa-calendar absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                        </div>
                        
                        <button id="clear-search" class="px-3 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                    
                    <!-- 添加记录按钮 -->
                    <button id="add-record-btn" class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors w-full md:w-auto">
                        <i class="fa fa-plus mr-2"></i>添加记录
                    </button>
                    
                    <!-- 暗黑模式切换 -->
                    <button id="theme-toggle" class="p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors">
                        <i class="fa fa-moon-o text-gray-700"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 搜索结果提示 -->
        <div class="mb-8">
        <img src="https://cdn.pixabay.com/photo/2025/05/12/14/26/white-cat-9595396_1280.jpg" alt="生活记录总览" class="w-full h-64 object-cover rounded-lg shadow-md">
        </div>
        <div id="search-result" class="mb-6 hidden">
            <p class="text-gray-600 transition-colors duration-300">
                找到 <span id="search-count"></span> 条匹配结果 
                <span id="search-criteria" class="text-sm opacity-75"></span>
            </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- 学习记录区域 -->
            <section class="bg-white rounded-lg section-shadow overflow-hidden transform transition hover:scale-[1.01] transition-colors duration-300" id="study-section">
                <div class="bg-study text-white p-4">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="fa fa-book mr-2"></i>学习记录
                        <span class="ml-2 bg-white/20 text-white text-sm px-2 py-0.5 rounded-full">
                            <span class="category-count" data-category="study">0</span>条
                        </span>
                    </h2>
                </div>
                <div class="p-5">
                    <!-- 学习内容容器 -->
                    <div id="study-content" class="space-y-4">
                        <!-- 内容将通过JS动态加载 -->
                    </div>
                    
                    <!-- 空状态提示 -->
                    <div class="empty-state hidden py-8 text-center">
                        <i class="fa fa-file-text-o text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 transition-colors duration-300">暂无记录，点击"添加记录"开始</p>
                    </div>
                    
                    <!-- 分页控制器 -->
                    <div class="pagination mt-6 flex justify-center items-center gap-2" data-category="study">
                        <button class="prev-page px-3 py-1 rounded border border-study text-study hover:bg-study hover:text-white transition" disabled>
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <div class="page-numbers flex gap-1"></div>
                        <button class="next-page px-3 py-1 rounded border border-study text-study hover:bg-study hover:text-white transition">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- 工作记录区域 -->
            <section class="bg-white rounded-lg section-shadow overflow-hidden transform transition hover:scale-[1.01] transition-colors duration-300" id="work-section">
                <div class="bg-work text-white p-4">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="fa fa-briefcase mr-2"></i>工作记录
                        <span class="ml-2 bg-white/20 text-white text-sm px-2 py-0.5 rounded-full">
                            <span class="category-count" data-category="work">0</span>条
                        </span>
                    </h2>
                </div>
                <div class="p-5">
                    <!-- 工作内容容器 -->
                    <div id="work-content" class="space-y-4">
                        <!-- 内容将通过JS动态加载 -->
                    </div>
                    
                    <!-- 空状态提示 -->
                    <div class="empty-state hidden py-8 text-center">
                        <i class="fa fa-file-text-o text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 transition-colors duration-300">暂无记录，点击"添加记录"开始</p>
                    </div>
                    
                    <!-- 分页控制器 -->
                    <div class="pagination mt-6 flex justify-center items-center gap-2" data-category="work">
                        <button class="prev-page px-3 py-1 rounded border border-work text-work hover:bg-work hover:text-white transition" disabled>
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <div class="page-numbers flex gap-1"></div>
                        <button class="next-page px-3 py-1 rounded border border-work text-work hover:bg-work hover:text-white transition">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- 生活记录区域 -->
            <section class="bg-white rounded-lg section-shadow overflow-hidden transform transition hover:scale-[1.01] transition-colors duration-300" id="life-section">
                <div class="bg-life text-white p-4">
                    <h2 class="text-xl font-bold flex items-center">
                        <i class="fa fa-home mr-2"></i>生活记录
                        <span class="ml-2 bg-white/20 text-white text-sm px-2 py-0.5 rounded-full">
                            <span class="category-count" data-category="life">0</span>条
                        </span>
                    </h2>
                </div>
                <div class="p-5">
                    <!-- 生活内容容器 -->
                    <div id="life-content" class="space-y-4">
                        <!-- 内容将通过JS动态加载 -->
                    </div>
                    
                    <!-- 空状态提示 -->
                    <div class="empty-state hidden py-8 text-center">
                        <i class="fa fa-file-text-o text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 transition-colors duration-300">暂无记录，点击"添加记录"开始</p>
                    </div>
                    
                    <!-- 分页控制器 -->
                    <div class="pagination mt-6 flex justify-center items-center gap-2" data-category="life">
                        <button class="prev-page px-3 py-1 rounded border border-life text-life hover:bg-life hover:text-white transition" disabled>
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <div class="page-numbers flex gap-1"></div>
                        <button class="next-page px-3 py-1 rounded border border-life text-life hover:bg-life hover:text-white transition">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <!-- 图片上传区域 -->
    <div class="container mx-auto px-4 pb-12">
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-gray-800 transition-colors duration-300">
                <i class="fa fa-images mr-2"></i>个人图片集
            </h2>
            <p class="text-gray-600 mt-1 transition-colors duration-300">点击下方区域上传图片，或拖放图片至此处</p>
        </div>
        
        <!-- 图片上传区域 -->
        <div id="image-upload-area" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-study transition-colors cursor-pointer bg-white/50">
            <i class="fa fa-cloud-upload text-5xl text-gray-400 mb-4"></i>
            <p class="text-gray-600 transition-colors duration-300 mb-2">点击或拖放图片到这里上传</p>
            <p class="text-sm text-gray-500 transition-colors duration-300">支持 JPG, PNG, GIF 格式，单张不超过5MB</p>
            <input type="file" id="image-upload" accept="image/*" multiple class="hidden">
        </div>
        
        <!-- 图片预览区域 -->
        <div id="image-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-6">
            <!-- 上传的图片将显示在这里 -->
            <div class="text-center py-8 text-gray-500 transition-colors duration-300" id="gallery-empty-state">
                <!-- 新增默认图片 -->
                <img src="https://cdn.pixabay.com/photo/2016/03/28/10/05/kitten-1285341_1280.jpg" alt="示例图片" class="w-full h-48 object-cover rounded-lg mb-2 mx-auto">
                暂无图片，上传第一张图片吧
            </div>
        </div>
    </div>

    <!-- 图片查看器模态框 -->
    <div id="image-viewer" class="fixed inset-0 bg-black/90 flex items-center justify-center z-50 hidden fade-in">
        <div class="relative max-w-5xl w-full max-h-[90vh] px-4">
            <button id="close-viewer" class="absolute -top-12 right-0 text-white text-2xl hover:text-gray-300 transition-colors">
                <i class="fa fa-times"></i>
            </button>
            <button id="download-image" class="absolute -top-12 left-0 bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg flex items-center transition-colors">
                <i class="fa fa-download mr-2"></i>下载图片
            </button>
            <div class="bg-white/10 p-1 rounded-lg">
                <img id="viewer-image" src="" alt="图片预览" class="max-w-full max-h-[90vh] object-contain zoom-in">
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-white mt-10 py-6 shadow-inner transition-colors duration-300" id="app-footer">
        <div class="container mx-auto px-4 text-center text-gray-600 transition-colors duration-300" id="footer-text">
            <!-- 新增图片 -->
            <img src="images/白猫.png" alt="谷树" class="w-12 h-12 mx-auto mb-2">
            <a href="new-page1.html" class="inline-block px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
             读书笔记
            </a>
            <p>最后更新: <span id="last-update">2025年8月12日</span></p>
            <p class="mt-2">文明精神，野蛮体魄</p>
        </div>
    </footer>

    <!-- 添加/编辑记录的模态框 -->
    <div id="record-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-lg w-full max-w-md p-6 shadow-xl transition-colors duration-300" id="modal-content">
            <h3 class="text-xl font-bold mb-4" id="modal-title">添加新记录</h3>
            
            <form id="record-form">
                <input type="hidden" id="record-id">
                
                <div class="mb-4">
                    <label for="record-category" class="block text-gray-700 mb-2 transition-colors duration-300">分类</label>
                    <select id="record-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-study/50">
                        <option value="study">学习记录</option>
                        <option value="work">工作记录</option>
                        <option value="life">生活记录</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label for="record-date" class="block text-gray-700 mb-2 transition-colors duration-300">日期</label>
                    <input type="date" id="record-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-study/50">
                </div>
                
                <div class="mb-6">
                    <label for="record-content" class="block text-gray-700 mb-2 transition-colors duration-300">内容</label>
                    <textarea id="record-content" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-study/50" placeholder="请输入记录内容..."></textarea>
                </div>
                
                <div class="flex gap-3">
                    <button type="button" id="cancel-btn" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors">取消</button>
                    <button type="submit" class="flex-1 px-4 py-2 bg-study text-white rounded-lg hover:bg-study/90 transition-colors">保存</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 全局变量
        let records = [];
        let images = [];
        let currentImageId = null; // 当前查看的图片ID
        const itemsPerPage = 3;
        let currentTheme = 'light';
        let searchContent = '';
        let searchDate = '';
        
        // DOM加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化数据
            initData();
            
            // 初始化事件监听
            initEventListeners();
            
            // 初始化分页
            ['study', 'work', 'life'].forEach(category => {
                initPagination(category);
            });
            
            // 更新最后更新日期
            updateLastUpdateDate();
            
            // 检查并应用保存的主题
            checkSavedTheme();
        });
        
        // 初始化数据（从本地存储或默认数据）
        function initData() {
            // 尝试从本地存储加载记录数据
            const savedRecords = localStorage.getItem('records');
            if (savedRecords) {
                records = JSON.parse(savedRecords);
            } else {
                // 使用默认数据
                records = [
                    {
                        id: '1',
                        category: 'study',
                        date: '2025-08-10',
                        content: '学习油猴脚本。今天学习了油猴脚本的使用，很多网站VIP视频可以免费看了，又省下一笔钱；CSDN,知乎等网站也可以不登录无广告了，新技术get！'
                    },
                    {
                        id: '2',
                        category: 'study',
                        date: '2025-08-12',
                        content: '网页颜色代码'
                    },
                    {
                        id: '3',
                        category: 'study',
                        date: '2025-08-12',
                        content: '开始学习手机系统python'
                    },
                    {
                        id: '4',
                        category: 'study',
                        date: '2025-08-12',
                        content: '学习python爬虫'
                    },
                    {
                        id: '5',
                        category: 'study',
                        date: '2025-08-13',
                        content: '学习网页的html语言，制作静态网站'
                    },
                    {
                        id: '6',
                        category: 'study',
                        date: '2025-08-14',
                        content: '学习JavaScript基础语法'
                    },
                    {
                        id: '7',
                        category: 'study',
                        date: '2025-08-15',
                        content: '学习Tailwind CSS布局技巧'
                    },
                    {
                        id: '8',
                        category: 'work',
                        date: '2025-08-10',
                        content: '把简历弄好，弄成pdf的，然后多多发等面试'
                    },
                    {
                        id: '9',
                        category: 'work',
                        date: '2025-08-12',
                        content: '确定长远目标，不断前进'
                    },
                    {
                        id: '10',
                        category: 'work',
                        date: '2025-08-13',
                        content: '确定长远目标，成为行业前百分之10'
                    },
                    {
                        id: '11',
                        category: 'work',
                        date: '2025-08-14',
                        content: '待写'
                    },
                    {
                        id: '12',
                        category: 'life',
                        date: '2025-08-11',
                        content: '衣服洗好了，荷塘月色'
                    },
                    {
                        id: '13',
                        category: 'life',
                        date: '2025-08-12',
                        content: '学一个新菜'
                    },
                    {
                        id: '14',
                        category: 'life',
                        date: '2025-08-13',
                        content: '公园锻炼'
                    },
                    {
                        id: '15',
                        category: 'life',
                        date: '2025-08-14',
                        content: '待写'
                    },
                    {
                        id: '16',
                        category: 'life',
                        date: '2025-08-15',
                        content: '和朋友聚餐'
                    }
                ];
                
                // 保存到本地存储
                saveRecords();
            }
            
            // 尝试从本地存储加载图片数据
            const savedImages = localStorage.getItem('images');
            if (savedImages) {
                images = JSON.parse(savedImages);
                renderImages();
            }
            
            // 渲染记录
            renderAllRecords();
            
            // 更新分类计数
            updateCategoryCounts();
        }
        
        // 初始化事件监听
        function initEventListeners() {
            // 添加记录按钮
            document.getElementById('add-record-btn').addEventListener('click', openAddModal);
            
            // 取消按钮
            document.getElementById('cancel-btn').addEventListener('click', closeModal);
            
            // 表单提交
            document.getElementById('record-form').addEventListener('submit', handleFormSubmit);
            
            // 暗黑模式切换
            document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
            
            // 搜索功能
            document.getElementById('search-content').addEventListener('input', handleSearch);
            document.getElementById('search-date').addEventListener('change', handleSearch);
            document.getElementById('clear-search').addEventListener('click', clearSearch);
            
            // 图片上传功能
            const uploadArea = document.getElementById('image-upload-area');
            const fileInput = document.getElementById('image-upload');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleImageUpload);
            
            // 拖放功能
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('border-study');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('border-study');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('border-study');
                
                if (e.dataTransfer.files.length) {
                    handleDroppedImages(e.dataTransfer.files);
                }
            });
            
            // 图片查看器事件
            document.getElementById('close-viewer').addEventListener('click', closeImageViewer);
            document.getElementById('download-image').addEventListener('click', downloadCurrentImage);
            
            // 点击图片查看器背景关闭
            document.getElementById('image-viewer').addEventListener('click', (e) => {
                if (e.target === document.getElementById('image-viewer')) {
                    closeImageViewer();
                }
            });
            
            // 按ESC键关闭图片查看器
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !document.getElementById('image-viewer').classList.contains('hidden')) {
                    closeImageViewer();
                }
            });
        }
        
        // 渲染所有记录
        function renderAllRecords() {
            ['study', 'work', 'life'].forEach(category => {
                renderRecordsByCategory(category);
            });
            
            // 更新搜索结果统计
            updateSearchResults();
        }
        
        // 按分类渲染记录
        function renderRecordsByCategory(category) {
            const container = document.getElementById(`${category}-content`);
            const emptyState = container.nextElementSibling; // 获取空状态元素
            
            // 清空容器
            container.innerHTML = '';
            
            // 获取该分类的记录，并按日期倒序排列
            let categoryRecords = records
                .filter(record => record.category === category)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // 应用搜索过滤
            if (searchContent || searchDate) {
                categoryRecords = categoryRecords.filter(record => {
                    // 内容搜索
                    const matchesContent = !searchContent || 
                                          record.content.toLowerCase().includes(searchContent.toLowerCase());
                    
                    // 日期搜索
                    const matchesDate = !searchDate || record.date === searchDate;
                    
                    return matchesContent && matchesDate;
                });
            }
            
            // 显示空状态或记录
            if (categoryRecords.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }
            
            // 创建记录元素
            categoryRecords.forEach(record => {
                const recordElement = createRecordElement(record);
                container.appendChild(recordElement);
            });
            
            // 更新分页
            updatePagination(category);
        }
        
        // 创建记录元素
        function createRecordElement(record) {
            const formattedDate = formatDate(record.date);
            const category = record.category;
            
            const div = document.createElement('div');
            div.className = `border-l-4 border-${category} pl-3 py-1 diary-item fade-in`;
            div.dataset.id = record.id;
            
            div.innerHTML = `
                <div class="flex justify-between items-start">
                    <h3 class="font-semibold text-gray-800 transition-colors duration-300">${formattedDate}</h3>
                    <div class="flex gap-1">
                        <button class="edit-btn text-gray-500 hover:text-${category} p-1" title="编辑">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <button class="delete-btn text-gray-500 hover:text-red-500 p-1" title="删除">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
                <p class="text-gray-600 mt-1 transition-colors duration-300">${record.content}</p>
            `;
            
            // 添加编辑和删除事件
            div.querySelector('.edit-btn').addEventListener('click', () => openEditModal(record.id));
            div.querySelector('.delete-btn').addEventListener('click', () => deleteRecord(record.id));
            
            return div;
        }
        
        // 初始化分页
        function initPagination(category) {
            const paginationContainer = document.querySelector(`.pagination[data-category="${category}"]`);
            const prevBtn = paginationContainer.querySelector('.prev-page');
            const nextBtn = paginationContainer.querySelector('.next-page');
            
            // 上一页按钮事件
            prevBtn.addEventListener('click', () => {
                const currentPage = getCurrentPage(category);
                if (currentPage > 1) {
                    setCurrentPage(category, currentPage - 1);
                    updatePagination(category);
                }
            });
            
            // 下一页按钮事件
            nextBtn.addEventListener('click', () => {
                const currentPage = getCurrentPage(category);
                const totalPages = getTotalPages(category);
                
                if (currentPage < totalPages) {
                    setCurrentPage(category, currentPage + 1);
                    updatePagination(category);
                }
            });
            
            // 初始更新分页
            updatePagination(category);
        }
        
        // 更新分页
        function updatePagination(category) {
            const container = document.getElementById(`${category}-content`);
            const items = container.querySelectorAll('.diary-item');
            const paginationContainer = document.querySelector(`.pagination[data-category="${category}"]`);
            const prevBtn = paginationContainer.querySelector('.prev-page');
            const nextBtn = paginationContainer.querySelector('.next-page');
            const pageNumbersContainer = paginationContainer.querySelector('.page-numbers');
            
            // 计算总页数
            const totalPages = Math.ceil(items.length / itemsPerPage);
            let currentPage = getCurrentPage(category) || 1;
            
            // 确保当前页在有效范围内
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
                setCurrentPage(category, currentPage);
            }
            
            // 隐藏所有条目
            items.forEach(item => {
                item.classList.add('hidden');
            });
            
            // 显示当前页的条目
            if (totalPages > 0) {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, items.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    items[i].classList.remove('hidden');
                }
            }
            
            // 更新页码按钮
            pageNumbersContainer.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `w-8 h-8 rounded-full flex items-center justify-center border transition ${
                    i === currentPage ? 'page-active' : `border-${category} text-${category} hover:bg-${category} hover:text-white`
                }`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    setCurrentPage(category, i);
                    updatePagination(category);
                });
                pageNumbersContainer.appendChild(pageBtn);
            }
            
            // 更新上一页/下一页按钮状态
            prevBtn.disabled = currentPage === 1 || totalPages === 0;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }
        
        // 获取当前页
        function getCurrentPage(category) {
            const paginationContainer = document.querySelector(`.pagination[data-category="${category}"]`);
            return paginationContainer.dataset.currentPage ? parseInt(paginationContainer.dataset.currentPage) : 1;
        }
        
        // 设置当前页
        function setCurrentPage(category, page) {
            const paginationContainer = document.querySelector(`.pagination[data-category="${category}"]`);
            paginationContainer.dataset.currentPage = page;
        }
        
        // 获取总页数
        function getTotalPages(category) {
            const container = document.getElementById(`${category}-content`);
            const items = container.querySelectorAll('.diary-item');
            return Math.ceil(items.length / itemsPerPage);
        }
        
        // 打开添加记录模态框
        function openAddModal() {
            // 重置表单
            document.getElementById('record-form').reset();
            document.getElementById('record-id').value = '';
            
            // 设置默认日期为今天
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('record-date').value = today;
            
            // 更新模态框标题
            document.getElementById('modal-title').textContent = '添加新记录';
            
            // 显示模态框
            document.getElementById('record-modal').classList.remove('hidden');
        }
        
        // 打开编辑记录模态框
        function openEditModal(id) {
            // 查找记录
            const record = records.find(r => r.id === id);
            if (!record) return;
            
            // 填充表单
            document.getElementById('record-id').value = record.id;
            document.getElementById('record-category').value = record.category;
            document.getElementById('record-date').value = record.date;
            document.getElementById('record-content').value = record.content;
            
            // 更新模态框标题
            document.getElementById('modal-title').textContent = '编辑记录';
            
            // 显示模态框
            document.getElementById('record-modal').classList.remove('hidden');
        }
        
        // 关闭模态框
        function closeModal() {
            document.getElementById('record-modal').classList.add('hidden');
        }
        
        // 处理表单提交
        function handleFormSubmit(e) {
            e.preventDefault();
            
            const id = document.getElementById('record-id').value;
            const category = document.getElementById('record-category').value;
            const date = document.getElementById('record-date').value;
            const content = document.getElementById('record-content').value;
            
            if (!date || !content) {
                alert('请填写日期和内容');
                return;
            }
            
            if (id) {
                // 编辑现有记录
                const index = records.findIndex(r => r.id === id);
                if (index !== -1) {
                    // 如果分类改变，需要重新渲染旧分类
                    const oldCategory = records[index].category;
                    records[index] = { ...records[index], category, date, content };
                    
                    // 保存并重新渲染
                    saveRecords();
                    renderRecordsByCategory(oldCategory);
                    renderRecordsByCategory(category);
                    updateCategoryCounts();
                    updateLastUpdateDate();
                }
            } else {
                // 添加新记录
                const newRecord = {
                    id: Date.now().toString(), // 使用时间戳作为ID
                    category,
                    date,
                    content
                };
                
                records.push(newRecord);
                
                // 保存并重新渲染
                saveRecords();
                renderRecordsByCategory(category);
                updateCategoryCounts();
                updateLastUpdateDate();
            }
            
            // 关闭模态框
            closeModal();
        }
        
        // 删除记录
        function deleteRecord(id) {
            if (confirm('确定要删除这条记录吗？')) {
                // 查找记录
                const index = records.findIndex(r => r.id === id);
                if (index !== -1) {
                    const category = records[index].category;
                    
                    // 删除记录
                    records.splice(index, 1);
                    
                    // 保存并重新渲染
                    saveRecords();
                    renderRecordsByCategory(category);
                    updateCategoryCounts();
                    updateLastUpdateDate();
                }
            }
        }
        
        // 保存记录到本地存储
        function saveRecords() {
            localStorage.setItem('records', JSON.stringify(records));
        }
        
        // 更新分类计数
        function updateCategoryCounts() {
            ['study', 'work', 'life'].forEach(category => {
                let count = records.filter(record => record.category === category).length;
                
                // 应用搜索过滤到计数
                if (searchContent || searchDate) {
                    count = records.filter(record => {
                        const matchesCategory = record.category === category;
                        const matchesContent = !searchContent || 
                                              record.content.toLowerCase().includes(searchContent.toLowerCase());
                        const matchesDate = !searchDate || record.date === searchDate;
                        
                        return matchesCategory && matchesContent && matchesDate;
                    }).length;
                }
                
                document.querySelector(`.category-count[data-category="${category}"]`).textContent = count;
            });
        }
        
        // 更新搜索结果统计
        function updateSearchResults() {
            const searchResult = document.getElementById('search-result');
            const searchCount = document.getElementById('search-count');
            const searchCriteria = document.getElementById('search-criteria');
            
            // 计算总匹配数
            if (searchContent || searchDate) {
                let criteriaText = '';
                
                if (searchContent && searchDate) {
                    criteriaText = `(内容包含: "${searchContent}" 且 日期: ${formatDate(searchDate)})`;
                } else if (searchContent) {
                    criteriaText = `(内容包含: "${searchContent}")`;
                } else if (searchDate) {
                    criteriaText = `(日期: ${formatDate(searchDate)})`;
                }
                
                const totalMatches = records.filter(record => {
                    const matchesContent = !searchContent || 
                                          record.content.toLowerCase().includes(searchContent.toLowerCase());
                    const matchesDate = !searchDate || record.date === searchDate;
                    
                    return matchesContent && matchesDate;
                }).length;
                
                searchCount.textContent = totalMatches;
                searchCriteria.textContent = criteriaText;
                searchResult.classList.remove('hidden');
            } else {
                searchResult.classList.add('hidden');
            }
        }
        
        // 处理搜索
        function handleSearch() {
            searchContent = document.getElementById('search-content').value.trim();
            searchDate = document.getElementById('search-date').value;
            
            // 重新渲染所有记录
            renderAllRecords();
            
            // 更新分类计数
            updateCategoryCounts();
        }
        
        // 清除搜索
        function clearSearch() {
            document.getElementById('search-content').value = '';
            document.getElementById('search-date').value = '';
            searchContent = '';
            searchDate = '';
            
            // 重新渲染所有记录
            renderAllRecords();
            
            // 更新分类计数
            updateCategoryCounts();
        }
        
        // 更新最后更新日期
        function updateLastUpdateDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('last-update').textContent = now.toLocaleDateString('zh-CN', options);
        }
        
        // 格式化日期
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('zh-CN', options);
        }
        
        // 切换暗黑模式
        function toggleTheme() {
            const body = document.getElementById('app-body');
            const header = document.getElementById('app-header');
            const footer = document.getElementById('app-footer');
            const mainTitle = document.getElementById('main-title');
            const subtitle = document.getElementById('subtitle');
            const footerText = document.getElementById('footer-text');
            const modalContent = document.getElementById('modal-content');
            const themeIcon = document.getElementById('theme-toggle').querySelector('i');
            
            if (currentTheme === 'light') {
                // 切换到暗黑模式
                body.classList.remove('bg-background');
                body.classList.add('bg-dark-bg', 'text-dark-text');
                
                header.classList.remove('bg-white');
                header.classList.add('bg-dark-card');
                
                footer.classList.remove('bg-white');
                footer.classList.add('bg-dark-card');
                
                mainTitle.classList.remove('text-gray-800');
                mainTitle.classList.add('text-white');
                
                subtitle.classList.remove('text-gray-600');
                subtitle.classList.add('text-gray-300');
                
                footerText.classList.remove('text-gray-600');
                footerText.classList.add('text-gray-300');
                
                modalContent.classList.remove('bg-white');
                modalContent.classList.add('bg-dark-card');
                
                // 更新所有section
                ['study', 'work', 'life'].forEach(category => {
                    const section = document.getElementById(`${category}-section`);
                    section.classList.remove('bg-white');
                    section.classList.add('bg-dark-card');
                });
                
                themeIcon.classList.remove('fa-moon-o');
                themeIcon.classList.add('fa-sun-o');
                
                currentTheme = 'dark';
            } else {
                // 切换到亮色模式
                body.classList.remove('bg-dark-bg', 'text-dark-text');
                body.classList.add('bg-background');
                
                header.classList.remove('bg-dark-card');
                header.classList.add('bg-white');
                
                footer.classList.remove('bg-dark-card');
                footer.classList.add('bg-white');
                
                mainTitle.classList.remove('text-white');
                mainTitle.classList.add('text-gray-800');
                
                subtitle.classList.remove('text-gray-300');
                subtitle.classList.add('text-gray-600');
                
                footerText.classList.remove('text-gray-300');
                footerText.classList.add('text-gray-600');
                
                modalContent.classList.remove('bg-dark-card');
                modalContent.classList.add('bg-white');
                
                // 更新所有section
                ['study', 'work', 'life'].forEach(category => {
                    const section = document.getElementById(`${category}-section`);
                    section.classList.remove('bg-dark-card');
                    section.classList.add('bg-white');
                });
                
                themeIcon.classList.remove('fa-sun-o');
                themeIcon.classList.add('fa-moon-o');
                
                currentTheme = 'light';
            }
            
            // 保存主题偏好
            localStorage.setItem('preferredTheme', currentTheme);
        }
        
        // 检查并应用保存的主题
        function checkSavedTheme() {
            const savedTheme = localStorage.getItem('preferredTheme');
            if (savedTheme && savedTheme === 'dark') {
                toggleTheme(); // 切换到暗黑模式
            }
        }
        
        // 处理图片上传
        function handleImageUpload(e) {
            const files = e.target.files;
            if (files.length) {
                processImageFiles(files);
            }
        }
        
        // 处理拖放的图片
        function handleDroppedImages(files) {
            processImageFiles(files);
        }
        
        // 处理图片文件
        function processImageFiles(files) {
            // 过滤非图片文件
            const imageFiles = Array.from(files).filter(file => 
                file.type.startsWith('image/')
            );
            
            if (imageFiles.length === 0) {
                alert('请选择图片文件');
                return;
            }
            
            imageFiles.forEach(file => {
                // 检查文件大小
                if (file.size > 5 * 1024 * 1024) { // 5MB
                    alert('图片大小不能超过5MB');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // 创建新图片对象
                    const newImage = {
                        id: Date.now().toString(),
                        url: e.target.result,
                        date: new Date().toISOString().split('T')[0],
                        fileName: file.name // 保存原始文件名
                    };
                    
                    // 添加到图片数组
                    images.unshift(newImage); // 添加到开头，最新的显示在前面
                    
                    // 保存并渲染
                    saveImages();
                    renderImages();
                };
                
                reader.readAsDataURL(file);
            });
            
            // 重置文件输入
            document.getElementById('image-upload').value = '';
        }
        
        // 渲染图片
        function renderImages() {
            const gallery = document.getElementById('image-gallery');
            const emptyState = document.getElementById('gallery-empty-state');
            
            // 清空画廊
            gallery.innerHTML = '';
            
            // 显示空状态或图片
            if (images.length === 0) {
                gallery.appendChild(emptyState);
                return;
            }
            
            // 创建图片元素
            images.forEach(image => {
                const imageContainer = document.createElement('div');
                imageContainer.className = 'relative rounded-lg overflow-hidden shadow-md group fade-in cursor-pointer';
                
                imageContainer.innerHTML = `
                    <div class="aspect-video image-placeholder" style="background-image: url('${image.url}')"></div>
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <button class="view-image bg-white/20 hover:bg-white/40 text-white p-2 rounded-full mx-1 transition-colors" data-id="${image.id}">
                            <i class="fa fa-search-plus"></i>
                        </button>
                        <button class="delete-image bg-white/20 hover:bg-white/40 text-white p-2 rounded-full mx-1 transition-colors" data-id="${image.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                    <div class="p-2 text-sm text-gray-600 bg-white transition-colors duration-300">
                        ${formatDate(image.date)}
                    </div>
                `;
                
                gallery.appendChild(imageContainer);
                
                // 添加查看图片事件
                imageContainer.addEventListener('click', (e) => {
                    // 如果点击的是操作按钮，则不触发查看大图
                    if (!e.target.closest('button')) {
                        openImageViewer(image.id);
                    }
                });
            });
            
            // 添加图片操作事件
            document.querySelectorAll('.view-image').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    const id = this.getAttribute('data-id');
                    openImageViewer(id);
                });
            });
            
            document.querySelectorAll('.delete-image').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡
                    const id = this.getAttribute('data-id');
                    deleteImage(id);
                });
            });
        }
        
        // 打开图片查看器
        function openImageViewer(id) {
            const image = images.find(img => img.id === id);
            if (!image) return;
            
            currentImageId = id;
            document.getElementById('viewer-image').src = image.url;
            document.getElementById('image-viewer').classList.remove('hidden');
            
            // 阻止页面滚动
            document.body.style.overflow = 'hidden';
        }
        
        // 关闭图片查看器
        function closeImageViewer() {
            document.getElementById('image-viewer').classList.add('hidden');
            currentImageId = null;
            
            // 恢复页面滚动
            document.body.style.overflow = '';
        }
        
        // 下载当前查看的图片
        function downloadCurrentImage() {
            if (!currentImageId) return;
            
            const image = images.find(img => img.id === currentImageId);
            if (!image) return;
            
            // 创建下载链接
            const link = document.createElement('a');
            
            // 提取文件扩展名
            let extension = 'png';
            if (image.fileName) {
                const parts = image.fileName.split('.');
                if (parts.length > 1) {
                    extension = parts.pop().toLowerCase();
                }
            }
            
            // 设置文件名 (使用日期+随机数确保唯一性)
            const date = new Date().toISOString().split('T')[0];
            const fileName = `my-image-${date}-${Math.random().toString(36).substr(2, 5)}.${extension}`;
            
            link.download = fileName;
            link.href = image.url;
            
            // 触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // 删除图片
        function deleteImage(id) {
            if (confirm('确定要删除这张图片吗？')) {
                images = images.filter(image => image.id !== id);
                saveImages();
                renderImages();
                
                // 如果删除的是当前查看的图片，关闭查看器
                if (currentImageId === id) {
                    closeImageViewer();
                }
            }
        }
        
        // 保存图片到本地存储
        function saveImages() {
            localStorage.setItem('images', JSON.stringify(images));
        }
    </script>
</body>
</html>
